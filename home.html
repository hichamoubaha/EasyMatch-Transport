<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyMatch Transport - Espace Expéditeur</title>
    <style>
        /* Variables et reset */
        :root {
            --color-primary: #FF7F00;
            --color-primary-dark: #E67300;
            --color-background: #F8F9FA;
            --color-white: #FFFFFF;
            --color-text: #1A1A1A;
            --color-muted: #6C757D;
            --color-border: #DEE2E6;
            --color-petit: #22C55E;
            --color-moyen: #EAB308;
            --color-grand: #EF4444;
            --color-vehicle: #3B82F6;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --radius: 0.5rem;
            --transition: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.5;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            padding: 1rem;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: var(--color-white);
            border-radius: var(--radius);
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            position: relative;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--color-muted);
            padding: 0.5rem;
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Package selection in modal */
        .package-selection {
            display: none;
            margin-top: 1rem;
        }

        .package-selection.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Buttons */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 0.875rem;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--color-primary-dark);
        }

        .btn-secondary {
            background-color: var(--color-background);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background-color: var(--color-border);
        }

        .reserve-btn {
            width: 100%;
            margin-top: 1rem;
            padding: 0.75rem;
            font-size: 1rem;
        }

        /* Route map updates */
        .route-map {
            background-color: #FFF5E6;
            border-radius: var(--radius);
            padding: 1.25rem;
            margin: 1rem 0;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            align-items: center;
        }

        .route-point {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .route-point-label {
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Package quantity selector improvements */
        .quantity-selector {
            margin-top: 1rem;
            display: grid;
            gap: 1rem;
        }

        .quantity-row {
            display: flex;
            align-items: center;
            padding: 1rem;
            background-color: var(--color-white);
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .quantity-row:hover {
            border-color: var(--color-primary);
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quantity-button {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            background-color: var(--color-white);
            cursor: pointer;
            transition: var(--transition);
        }

        .quantity-button:hover {
            background-color: var(--color-background);
            border-color: var(--color-primary);
        }

        .quantity-value {
            min-width: 2rem;
            text-align: center;
            font-weight: 500;
        }

        /* Form improvements */
        .fragile-section {
            margin-bottom: 1.5rem;
        }

        .fragile-section label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .fragile-options {
            display: flex;
            gap: 1rem;
        }

        .fragile-option {
            flex: 1;
            padding: 1rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .fragile-option:hover {
            border-color: var(--color-primary);
        }

        .fragile-option.active {
            border-color: var(--color-primary);
            background-color: #FFF5E6;
        }

        /* Rest of your existing styles... */
        .header {
            background-color: var(--color-white);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--color-text);
        }

        /* Package quantity selector */
        .package-quantity {
            background-color: var(--color-white);
            padding: 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .quantity-row {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            margin-bottom: 0.5rem;
        }

        .quantity-icon {
            width: 24px;
            height: 24px;
            margin-right: 1rem;
        }

        .quantity-icon.petit { color: var(--color-petit); }
        .quantity-icon.moyen { color: var(--color-moyen); }
        .quantity-icon.grand { color: var(--color-grand); }

        .quantity-label {
            flex: 1;
            font-weight: 500;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quantity-button {
            width: 32px;
            height: 32px;
            border: 1px solid var(--color-border);
            background: var(--color-white);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-button:hover {
            background-color: var(--color-background);
        }

        .quantity-value {
            min-width: 2rem;
            text-align: center;
            font-weight: 500;
        }

        /* Package cards */
        .package-cards {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }

        .package-card {
            background-color: var(--color-white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .route-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .vehicle-type {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--color-vehicle);
            font-weight: 500;
        }

        .vehicle-icon {
            width: 24px;
            height: 24px;
            color: var(--color-vehicle);
        }

        .driver-info {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .driver-avatar {
            width: 48px;
            height: 48px;
            border-radius: 9999px;
            background-color: #FF69B4;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .driver-details {
            flex: 1;
        }

        .driver-name {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .driver-meta {
            color: var(--color-muted);
            font-size: 0.875rem;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .package-info {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .package-count {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .package-icon {
            width: 20px;
            height: 20px;
        }

        .fragile-warning {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #EF4444;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .route-map {
            background-color: #FFF5E6;
            border-radius: var(--radius);
            padding: 1.25rem;
            margin: 1rem 0;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            align-items: center;
        }

        .route-point {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            min-width: 60px;
        }

        .route-point-icon {
            width: 24px;
            height: 24px;
        }

        .route-point-label {
            font-size: 0.75rem;
            font-weight: 500;
            text-align: center;
        }

        .route-line {
            width: 1.5rem;
            height: 2px;
            background-color: var(--color-primary);
            flex-shrink: 0;
        }

        .card-footer {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--color-border);
            font-size: 0.875rem;
            color: var(--color-muted);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .footer-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Custom icons */
        .icon-petit {
            width: 20px;
            height: 20px;
            color: var(--color-petit);
        }

        .icon-moyen {
            width: 20px;
            height: 20px;
            color: var(--color-moyen);
        }

        .icon-grand {
            width: 20px;
            height: 20px;
            color: var(--color-grand);
        }

        /* Vehicle icons */
        .vehicle-icon-camion {
            color: var(--color-vehicle);
        }

        /* Form styles */
        .form-section {
            background-color: var(--color-white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .form-grid {
            display: grid;
            gap: 1rem;
        }

        @media (min-width: 640px) {
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--color-border);
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 1px var(--color-primary);
        }

        .submit-button {
            background-color: var(--color-primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            margin-top: 1rem;
        }

        .submit-button:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-section">
            <h2 class="form-title">Poster une offre de transport</h2>
            <form id="transportForm" onsubmit="handleSubmit(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="nom">Nom</label>
                        <input class="form-input" type="text" id="nom" name="nom" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="prenom">Prénom</label>
                        <input class="form-input" type="text" id="prenom" name="prenom" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="dateNaissance">Date de naissance</label>
                        <input class="form-input" type="date" id="dateNaissance" name="dateNaissance" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="ville">Ville</label>
                        <input class="form-input" type="text" id="ville" name="ville" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="sex">Sexe</label>
                        <select class="form-select" id="sex" name="sex" required>
                            <option value="">Sélectionner</option>
                            <option value="homme">Homme</option>
                            <option value="femme">Femme</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="numeroPermis">Numéro de permis</label>
                        <input class="form-input" type="text" id="numeroPermis" name="numeroPermis" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="depart">Ville de départ</label>
                        <input class="form-input" type="text" id="depart" name="depart" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="arrivee">Ville d'arrivée</label>
                        <input class="form-input" type="text" id="arrivee" name="arrivee" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Quantité de colis par taille</label>
                    <div class="quantity-selector">
                        <div class="quantity-row">
                            <svg class="icon-petit" viewBox="0 0 24 24" fill="currentColor">
                                <rect x="4" y="4" width="16" height="16" rx="2"/>
                            </svg>
                            <span class="quantity-label">Petit</span>
                            <div class="quantity-controls">
                                <button type="button" class="quantity-button" onclick="updateQuantity('petit', -1)">-</button>
                                <span class="quantity-value" id="petit-value">0</span>
                                <input type="hidden" name="colisPetit" id="colisPetit" value="0">
                                <button type="button" class="quantity-button" onclick="updateQuantity('petit', 1)">+</button>
                            </div>
                        </div>
                        <div class="quantity-row">
                            <svg class="icon-moyen" viewBox="0 0 24 24" fill="currentColor">
                                <rect x="4" y="4" width="16" height="16" rx="2"/>
                                <line x1="4" y1="12" x2="20" y2="12" stroke="white" stroke-width="2"/>
                            </svg>
                            <span class="quantity-label">Moyen</span>
                            <div class="quantity-controls">
                                <button type="button" class="quantity-button" onclick="updateQuantity('moyen', -1)">-</button>
                                <span class="quantity-value" id="moyen-value">0</span>
                                <input type="hidden" name="colisMoyen" id="colisMoyen" value="0">
                                <button type="button" class="quantity-button" onclick="updateQuantity('moyen', 1)">+</button>
                            </div>
                        </div>
                        <div class="quantity-row">
                            <svg class="icon-grand" viewBox="0 0 24 24" fill="currentColor">
                                <rect x="2" y="2" width="20" height="20" rx="2"/>
                            </svg>
                            <span class="quantity-label">Grand</span>
                            <div class="quantity-controls">
                                <button type="button" class="quantity-button" onclick="updateQuantity('grand', -1)">-</button>
                                <span class="quantity-value" id="grand-value">0</span>
                                <input type="hidden" name="colisGrand" id="colisGrand" value="0">
                                <button type="button" class="quantity-button" onclick="updateQuantity('grand', 1)">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="vehicule">Type de véhicule</label>
                        <select class="form-select" id="vehicule" name="vehicule" required>
                            <option value="">Sélectionner</option>
                            <option value="pickup">Pick-up</option>
                            <option value="camion-frigo">Camion Frigorifique</option>
                            <option value="car">Voiture</option>
                            <option value="triporteur">Triporteur</option>
                            <option value="moto">Moto</option>
                            <option value="taxi-petit">Petit Taxi</option>
                            <option value="camion">Camion</option>
                            <option value="taxi-grand">Grand Taxi</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="matriculeVehicule">Immatriculation du véhicule</label>
                        <input class="form-input" type="text" id="matriculeVehicule" name="matriculeVehicule" required>
                    </div>
                    <div class="fragile-section">
                        <label>Colis fragile</label>
                        <div class="fragile-options">
                            <div class="fragile-option" onclick="toggleFragile('non')">Non</div>
                            <div class="fragile-option" onclick="toggleFragile('oui')">Oui</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="dateFin">Date de fin de l'annonce</label>
                        <input class="form-input" type="date" id="dateFin" name="dateFin" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="description">Description</label>
                    <textarea class="form-textarea" id="description" name="description" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label" for="etapes">Étapes intermédiaires (séparées par des virgules)</label>
                    <input class="form-input" type="text" id="etapes" name="etapes" placeholder="Ex: Essaouira, Rabat, Fès">
                </div>

                <button type="submit" class="submit-button">Postuler</button>
            </form>
        </div>

        <div class="form-section">
            <h2 class="form-title">Offres de colis acceptées</h2>
            <div id="packageCards" class="package-cards"></div>
        </div>
    </div>

    <div id="reservationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Réserver le transport</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="route-info">
                    <h4>Itinéraire</h4>
                    <div id="modalRoute" class="route-map"></div>
                </div>
                
                <div class="fragile-section">
                    <label>Votre colis est-il fragile ?</label>
                    <div class="fragile-options">
                        <div class="fragile-option" onclick="toggleFragile('non')">Non</div>
                        <div class="fragile-option" onclick="toggleFragile('oui')">Oui</div>
                    </div>
                </div>

                <div id="packageSelection" class="package-selection">
                    <h4>Sélectionnez la quantité par taille</h4>
                    <div class="quantity-selector">
                        
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Annuler</button>
                <button class="btn btn-primary" onclick="confirmReservation()">Confirmer</button>
            </div>
        </div>
    </div>

    <script>
        // Fonction pour capitaliser la première lettre
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
        }

        // Fonction pour calculer l'âge
        function calculateAge(dateNaissance) {
            const today = new Date();
            const birthDate = new Date(dateNaissance);
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        // Fonction pour mettre à jour la quantité
        function updateQuantity(type, change) {
            const valueElement = document.getElementById(`${type}-value`);
            const inputElement = document.getElementById(`colis${capitalize(type)}`);
            let currentValue = parseInt(valueElement.textContent);
            currentValue = Math.max(0, currentValue + change);
            valueElement.textContent = currentValue;
            inputElement.value = currentValue;
        }

        // Fonction pour obtenir l'icône de véhicule
        function getVehicleIcon(type) {
            return `
                <svg class="vehicle-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12h18M21 12v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4m18 0-3-6H6L3 12m18 0h-3M3 12h3"/>
                </svg>
            `;
        }

        // Fonction pour créer une carte de package
        function createPackageCard(offre) {
            const card = document.createElement('div');
            card.className = 'package-card';

            card.innerHTML = `
                <div class="card-header">
                    <span class="route-title">${capitalize(offre.depart)} → ${capitalize(offre.arrivee)}</span>
                    <div class="vehicle-type">
                        ${getVehicleIcon(offre.vehicule)}
                        ${capitalize(offre.vehicule.replace('-', ' '))}
                    </div>
                </div>

                <div class="driver-info">
                    <div class="driver-avatar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    </div>
                    <div class="driver-details">
                        <div class="driver-name">${capitalize(offre.prenom)} ${capitalize(offre.nom)}</div>
                        <div class="driver-meta">
                            <div>${calculateAge(offre.dateNaissance)} ans</div>
                            <div>${capitalize(offre.ville)}</div>
                            <div>Permis: ${offre.numeroPermis}</div>
                        </div>
                    </div>
                </div>

                <div class="package-info">
                    ${offre.colisPetit > 0 ? `
                        <div class="package-count">
                            <svg class="icon-petit" viewBox="0 0 24 24" fill="currentColor">
                                <rect x="4" y="4" width="16" height="16" rx="2"/>
                            </svg>
                            ×${offre.colisPetit}
                        </div>
                    ` : ''}
                    ${offre.colisMoyen > 0 ? `
                        <div class="package-count">
                            <svg class="icon-moyen" viewBox="0 0 24 24" fill="currentColor">
                                <rect x="4" y="4" width="16" height="16" rx="2"/>
                                <line x1="4" y1="12" x2="20" y2="12" stroke="white" stroke-width="2"/>
                            </svg>
                            ×${offre.colisMoyen}
                        </div>
                    ` : ''}
                    ${offre.colisGrand > 0 ? `
                        <div class="package-count">
                            <svg class="icon-grand" viewBox="0 0 24 24" fill="currentColor">
                                <rect x="2" y="2" width="20" height="20" rx="2"/>
                            </svg>
                            ×${offre.colisGrand}
                        </div>
                    ` : ''}
                </div>

                ${offre.fragile === 'oui' ? `
                    <div class="fragile-warning">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                            <line x1="12" y1="9" x2="12" y2="13"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                        Colis fragile
                    </div>
                ` : ''}

                <div>${offre.description}</div>

                <div class="route-map">
                    ${[offre.depart, ...offre.etapes, offre.arrivee].map((step, index, array) => `
                        <div class="route-point">
                            ${index === 0 ? `
                                <svg class="route-point-icon" viewBox="0 0 24 24" fill="none" stroke="#22C55E" stroke-width="2">
                                    <path d="M12 2L2 12h4v8h12v-8h4L12 2z"/>
                                </svg>
                            ` : index === array.length - 1 ? `
                                <svg class="route-point-icon" viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2">
                                    <path d="M4 15s1-1 4-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/>
                                    <line x1="4" y1="22" x2="4" y2="15"/>
                                </svg>
                            ` : `
                                <svg class="route-point-icon" viewBox="0 0 24 24" fill="none" stroke="#FF7F00" stroke-width="2">
                                    <circle cx="12" cy="12" r="8"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                            `}
                            <span class="route-point-label">${capitalize(step)}</span>
                        </div>
                        ${index < array.length - 1 ? '<div class="route-line"></div>' : ''}
                    `).join('')}
                </div>

                <div class="card-footer">
                    <div class="footer-info">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <path d="M3 9h18"/>
                        </svg>
                        Immatriculation: ${offre.matriculeVehicule}
                    </div>
                    <div class="footer-info">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        Fin de l'annonce: ${new Date(offre.dateFin).toLocaleDateString()}
                    </div>
                </div>
            `;

            const reserveButton = document.createElement('button');
            reserveButton.className = 'btn btn-primary reserve-btn';
            reserveButton.textContent = 'Réserver';
            reserveButton.onclick = () => openReservationModal(offre);
            
            card.appendChild(reserveButton);
            
            return card;
        }

        // Gestionnaire de soumission du formulaire
        function handleSubmit(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            const offre = {
                nom: formData.get('nom'),
                prenom: formData.get('prenom'),
                dateNaissance: formData.get('dateNaissance'),
                ville: formData.get('ville'),
                sex: formData.get('sex'),
                numeroPermis: formData.get('numeroPermis'),
                depart: formData.get('depart'),
                arrivee: formData.get('arrivee'),
                colisPetit: parseInt(formData.get('colisPetit')),
                colisMoyen: parseInt(formData.get('colisMoyen')),
                colisGrand: parseInt(formData.get('colisGrand')),
                vehicule: formData.get('vehicule'),
                matriculeVehicule: formData.get('matriculeVehicule'),
                fragile: formData.get('fragile'),
                dateFin: formData.get('dateFin'),
                description: formData.get('description'),
                etapes: formData.get('etapes').split(',').map(e => e.trim()).filter(e => e)
            };

            const packageCards = document.getElementById('packageCards');
            packageCards.insertBefore(createPackageCard(offre), packageCards.firstChild);

            // Réinitialiser le formulaire
            event.target.reset();
            document.querySelectorAll('[data-quantity]').forEach(el => el.textContent = '0');
            document.querySelectorAll('input[type="hidden"][name^="colis"]').forEach(el => el.value = '0');
        }

        // New functions for modal handling
        function openReservationModal(offre) {
            const modal = document.getElementById('reservationModal');
            const modalRoute = document.getElementById('modalRoute');
            
            // Update route display
            modalRoute.innerHTML = createRouteDisplay(offre.depart, offre.etapes, offre.arrivee);
            
            // Reset fragile selection
            document.querySelectorAll('.fragile-option').forEach(opt => opt.classList.remove('active'));
            document.getElementById('packageSelection').classList.remove('active');
            
            // Show modal
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('reservationModal').classList.remove('active');
        }

        function toggleFragile(value) {
            document.querySelectorAll('.fragile-option').forEach(opt => opt.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            const packageSelection = document.getElementById('packageSelection');
            if (value === 'oui') {
                packageSelection.classList.add('active');
                // Initialize quantity selector if needed
                if (!packageSelection.querySelector('.quantity-row')) {
                    initializeQuantitySelector();
                }
            } else {
                packageSelection.classList.remove('active');
            }
        }

        function initializeQuantitySelector() {
            const selector = document.querySelector('.quantity-selector');
            selector.innerHTML = `
                <div class="quantity-row">
                    <svg class="icon-petit" viewBox="0 0 24 24" fill="currentColor">
                        <rect x="4" y="4" width="16" height="16" rx="2"/>
                    </svg>
                    <span class="quantity-label">Petit</span>
                    <div class="quantity-controls">
                        <button class="quantity-button" onclick="updateModalQuantity('petit', -1)">-</button>
                        <span class="quantity-value" id="modal-petit-value">0</span>
                        <button class="quantity-button" onclick="updateModalQuantity('petit', 1)">+</button>
                    </div>
                </div>
                <div class="quantity-row">
                    <svg class="icon-moyen" viewBox="0 0 24 24" fill="currentColor">
                        <rect x="4" y="4" width="16" height="16" rx="2"/>
                        <line x1="4" y1="12" x2="20" y2="12" stroke="white" stroke-width="2"/>
                    </svg>
                    <span class="quantity-label">Moyen</span>
                    <div class="quantity-controls">
                        <button class="quantity-button" onclick="updateModalQuantity('moyen', -1)">-</button>
                        <span class="quantity-value" id="modal-moyen-value">0</span>
                        <button class="quantity-button" onclick="updateModalQuantity('moyen', 1)">+</button>
                    </div>
                </div>
                <div class="quantity-row">
                    <svg class="icon-grand" viewBox="0 0 24 24" fill="currentColor">
                        <rect x="2" y="2" width="20" height="20" rx="2"/>
                    </svg>
                    <span class="quantity-label">Grand</span>
                    <div class="quantity-controls">
                        <button class="quantity-button" onclick="updateModalQuantity('grand', -1)">-</button>
                        <span class="quantity-value" id="modal-grand-value">0</span>
                        <button class="quantity-button" onclick="updateModalQuantity('grand', 1)">+</button>
                    </div>
                </div>
            `;
        }

        function updateModalQuantity(type, change) {
            const valueElement = document.getElementById(`modal-${type}-value`);
            let currentValue = parseInt(valueElement.textContent);
            currentValue = Math.max(0, currentValue + change);
            valueElement.textContent = currentValue;
        }

        function confirmReservation() {
            // Collect all the data and handle the reservation
            const fragile = document.querySelector('.fragile-option.active')?.textContent === 'Oui';
            const quantities = {
                petit: parseInt(document.getElementById('modal-petit-value')?.textContent || '0'),
                moyen: parseInt(document.getElementById('modal-moyen-value')?.textContent || '0'),
                grand: parseInt(document.getElementById('modal-grand-value')?.textContent || '0')
            };
            
            // Handle the reservation (you can implement your logic here)
            console.log('Reservation confirmed:', { fragile, quantities });
            
            // Close the modal
            closeModal();
        }


        function createRouteDisplay(depart, etapes, arrivee) {
            const allPoints = [depart, ...etapes, arrivee];
            return allPoints.map((point, index, array) => `
                <div class="route-point">
                    ${getRoutePointIcon(index, array.length)}
                    <span class="route-point-label">${capitalize(point)}</span>
                </div>
                ${index < array.length - 1 ? '<div class="route-line"></div>' : ''}
            `).join('');
        }

        function getRoutePointIcon(index, total) {
            const color = index === 0 ? '#22C55E' : 
                         index === total - 1 ? '#EF4444' : '#FF7F00';
            return `
                <svg class="route-point-icon" width="24" height="24" viewBox="0 0 24 24" 
                     fill="none" stroke="${color}" stroke-width="2">
                    ${index === 0 ? `
                        <path d="M12 2L2 12h4v8h12v-8h4L12 2z"/>
                    ` : index === total - 1 ? `
                        <path d="M4 15s1-1 4-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/>
                        <line x1="4" y1="22" x2="4" y2="15"/>
                    ` : `
                        <circle cx="12" cy="12" r="8"/>
                        <circle cx="12" cy="12" r="3"/>
                    `}
                </svg>
            `;
        }
    </script>
</body>
</html>

